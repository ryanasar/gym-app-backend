generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Achievement {
  id        Int      @id @default(autoincrement())
  userId    Int
  workoutId Int?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout   Workout? @relation(fields: [workoutId], references: [id])
  posts     Post[]

  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Comment {
  id        Int      @id @default(autoincrement())
  content   String?
  timestamp DateTime @default(now())
  postId    Int?
  userId    Int
  splitId   Int?
  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  split     Split?   @relation(fields: [splitId], references: [id], onDelete: Cascade)
  author    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Exercise {
  sets               Int?
  reps               Int?
  weight             Int?
  id                 Int              @id @default(autoincrement())
  workoutId          Int
  exerciseTemplateId Int
  template           ExerciseTemplate @relation(fields: [exerciseTemplateId], references: [id])
  workout            Workout          @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  muscles            MuscleExercise[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model ExerciseTemplate {
  id                      Int                      @id @default(autoincrement())
  name                    String                   @unique
  description             String?
  imageUrl                String?
  equipment               String?
  difficulty              String?
  exercises               Exercise[]
  muscles                 MuscleExerciseTemplate[]
  workoutSessionExercises WorkoutSessionExercise[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Follows {
  followedById Int
  followingId  Int
  followedBy   User @relation("Follows_followedByIdToUser", fields: [followedById], references: [id], onDelete: Cascade)
  following    User @relation("Follows_followingIdToUser", fields: [followingId], references: [id], onDelete: Cascade)

  @@id([followingId, followedById])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Like {
  id        Int      @id @default(autoincrement())
  timestamp DateTime @default(now())
  postId    Int?
  userId    Int
  splitId   Int?
  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  split     Split?   @relation(fields: [splitId], references: [id], onDelete: Cascade)
  author    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Muscle {
  id        Int                      @id @default(autoincrement())
  name      String?                  @unique
  exercises MuscleExercise[]
  templates MuscleExerciseTemplate[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model MuscleExercise {
  muscleId   Int
  exerciseId Int
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  muscle     Muscle   @relation(fields: [muscleId], references: [id], onDelete: Cascade)

  @@id([muscleId, exerciseId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model MuscleExerciseTemplate {
  muscleId           Int
  exerciseTemplateId Int
  exerciseTemplate   ExerciseTemplate @relation(fields: [exerciseTemplateId], references: [id], onDelete: Cascade)
  muscle             Muscle           @relation(fields: [muscleId], references: [id], onDelete: Cascade)

  @@id([muscleId, exerciseTemplateId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Post {
  id               Int             @id @default(autoincrement())
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  title            String?
  published        Boolean         @default(false)
  authorId         Int
  achievementId    Int?
  workoutId        Int?
  description      String?
  splitId          Int?
  workoutSessionId Int?
  streak           Int?
  imageUrl         String?
  comments         Comment[]
  likes            Like[]
  taggedUsers      PostTag[]
  achievement      Achievement?    @relation(fields: [achievementId], references: [id])
  author           User            @relation("UserPosts", fields: [authorId], references: [id], onDelete: Cascade)
  split            Split?          @relation(fields: [splitId], references: [id])
  workout          Workout?        @relation(fields: [workoutId], references: [id])
  workoutSession   WorkoutSession? @relation(fields: [workoutSessionId], references: [id])

  @@index([authorId])
}

/// Join table for tagged users in posts
model PostTag {
  id        Int      @id @default(autoincrement())
  postId    Int
  userId    Int
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation("TaggedInPosts", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Profile {
  id         Int      @id @default(autoincrement())
  bio        String?
  userId     Int      @unique
  isPrivate  Boolean?
  avatarUrl  String?
  isVerified Boolean  @default(false)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Split {
  id              Int              @id @default(autoincrement())
  userId          Int
  name            String
  emoji           String?
  description     String?
  isPublic        Boolean?         @default(false)
  numDays         Int?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  started         Boolean          @default(false)
  comments        Comment[]
  likes           Like[]
  Post            Post[]
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutDays     WorkoutDay[]
  workoutSessions WorkoutSession[]

  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model User {
  email                  String           @unique
  name                   String?
  createdAt              DateTime         @default(now())
  id                     Int              @id @default(autoincrement())
  username               String?          @unique
  supabaseId             String?          @unique
  hasCompletedOnboarding Boolean          @default(false)
  firstName              String?
  lastName               String?
  achievements           Achievement[]
  comments               Comment[]
  followedBy             Follows[]        @relation("Follows_followedByIdToUser")
  following              Follows[]        @relation("Follows_followingIdToUser")
  likes                  Like[]
  posts                  Post[]           @relation("UserPosts")
  taggedInPosts          PostTag[]        @relation("TaggedInPosts")
  profile                Profile?
  splits                 Split[]
  workouts               Workout[]
  workoutSessions        WorkoutSession[]
  savedWorkouts          SavedWorkout[]

  @@index([username])
}

/// Saved workout templates that users can reuse
model SavedWorkout {
  id          Int      @id @default(autoincrement())
  userId      Int
  name        String
  description String?
  emoji       String?
  workoutType String?
  exercises   Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Workout {
  notes        String?
  userId       Int
  id           Int           @id @default(autoincrement())
  title        String?
  achievements Achievement[]
  exercises    Exercise[]
  Post         Post[]
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  WorkoutDay   WorkoutDay[]

  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model WorkoutDay {
  id                 Int      @id @default(autoincrement())
  dayIndex           Int?
  isRest             Boolean? @default(false)
  workoutId          Int?
  emoji              String?
  exercises          Json?
  splitId            Int?
  workoutDescription String?
  workoutName        String?
  workoutType        String?
  split              Split?   @relation(fields: [splitId], references: [id], onDelete: Cascade)
  workout            Workout? @relation(fields: [workoutId], references: [id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model WorkoutSession {
  id          Int                      @id @default(autoincrement())
  userId      Int
  splitId     Int?
  dayName     String
  weekNumber  Int?
  dayNumber   Int?
  startedAt   DateTime                 @default(now())
  completedAt DateTime?
  notes       String?
  posts       Post[]
  split       Split?                   @relation(fields: [splitId], references: [id])
  user        User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercises   WorkoutSessionExercise[]

  @@index([completedAt])
  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model WorkoutSessionExercise {
  id                 Int               @id @default(autoincrement())
  workoutSessionId   Int
  exerciseName       String
  exerciseTemplateId Int?
  orderIndex         Int
  notes              String?
  template           ExerciseTemplate? @relation(fields: [exerciseTemplateId], references: [id])
  workoutSession     WorkoutSession    @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)
  sets               WorkoutSet[]

  @@index([workoutSessionId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model WorkoutSet {
  id                       Int                    @id @default(autoincrement())
  workoutSessionExerciseId Int
  setNumber                Int
  weight                   Float?
  reps                     Int?
  rpe                      Float?
  restSeconds              Int?
  completed                Boolean                @default(false)
  completedAt              DateTime?
  exercise                 WorkoutSessionExercise @relation(fields: [workoutSessionExerciseId], references: [id], onDelete: Cascade)

  @@index([workoutSessionExerciseId])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Notifications {
  id           String    @id(map: "notifications_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  recipient_id String
  actor_id     String
  type         String
  post_id      String?
  comment_id   String?
  is_read      Boolean?  @default(false)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)

  @@index([recipient_id, created_at(sort: Desc)], map: "notifications_recipient_created_idx")
  @@index([recipient_id, is_read], map: "notifications_recipient_read_idx")
}
